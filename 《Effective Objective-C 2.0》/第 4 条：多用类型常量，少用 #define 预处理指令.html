<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.3 (452849)"/><meta name="altitude" content="14.22299194335938"/><meta name="author" content="郭嘉"/><meta name="created" content="2016-01-04 13:27:11 +0000"/><meta name="latitude" content="30.22822991128422"/><meta name="longitude" content="120.0331568506173"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2016-01-05 05:20:58 +0000"/><title>第 4 条：多用类型常量，少用 #define 预处理指令</title></head><body>
<div>
<p style="text-align: justify; word-break: break-word; color: rgb(47, 47, 47); font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(252, 250, 242);">若定义动画播放时间间隔为常量，通常做法：</p>
<pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: rgb(253, 246, 227);">
<code style="padding: 0px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;"><span style="color: rgb(203, 75, 22);">#<span style="color: rgb(203, 75, 22);">define</span> ANIMATION_DURAION <span style="color: rgb(42, 161, 152);">0.3</span></span></code>
</pre>
<p style="text-align: justify; word-break: break-word; color: rgb(47, 47, 47); font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(252, 250, 242);">这样的预处理指令没有给出类型信息。下述方法比预处理指令定义常量更好（包含类型信息）：</p>
<pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: rgb(253, 246, 227);">
<code style="padding: 0px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;"><span style="color: rgb(133, 153, 0);">static</span> <span style="color: rgb(133, 153, 0);">const</span> <span style="color: rgb(38, 139, 210);">NSTimeInterval</span> kAnimationDuration = <span style="color: rgb(42, 161, 152);">0.3</span>; <span style="color: rgb(147, 161, 161);">//清楚地描述了常量的含义</span></code>
</pre>
<blockquote style="padding: 10px 15px; border-left-width: 4px; border-left-style: solid; border-left-color: rgb(153, 153, 153); word-break: break-word; font-size: 15px; font-weight: 100; color: rgb(47, 47, 47); font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: whitesmoke;">
<p style="font-size: 15px; font-weight: normal; text-align: justify; word-break: break-word;">常量命名法：若常量局限于某“编译单元”（translation unit，也就是“实现文件”，implementation file），则在前面加字母 k；若常量在类之外可见，则常以类名为前缀。</p>
</blockquote>
<p style="text-align: justify; word-break: break-word; color: rgb(47, 47, 47); font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(252, 250, 242);">定义常量的位置也很重要。若不打算公开某个常量，则应将其定义在使用该常量的实现文件中。</p>
<p style="text-align: justify; word-break: break-word; color: rgb(47, 47, 47); font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(252, 250, 242);">变量一定要同时用 <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">static</code> 和 <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">const</code> 来声明。若试图修改由 <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">const</code> 修饰符所声明的变量，那么编译器就会报错。</p>
<p style="text-align: justify; word-break: break-word; color: rgb(47, 47, 47); font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(252, 250, 242);">若声明此变量时不加 <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">static</code>，编译器会为它创建一个“外部符号”（external symbol）。此时若另一个编译单元也声明了同名变量，则会报错。<br/>
若一个变量既声明为 <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">static</code>, 又声明为 <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">const</code>，则编译器不会创建符号，而是会想<code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">#define</code> 预处理指令一样，把所有遇到的变量都替换为（有类型信息的）常值。</p>
<p style="text-align: justify; word-break: break-word; color: rgb(47, 47, 47); font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(252, 250, 242);">有时候需要对外公开某个常量，例如使用通知（NSNotificationCenter）。<br/>
定义方式：</p>
<pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: rgb(253, 246, 227);">
<code style="padding: 0px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;"><span style="color: rgb(147, 161, 161);">// 头文件“声明”</span>
<span style="color: rgb(133, 153, 0);">extern</span> <span style="color: rgb(38, 139, 210);">NSString</span> *<span style="color: rgb(133, 153, 0);">const</span> EOCStringConstant; <span style="color: rgb(147, 161, 161);">//注意 const 位置</span>

<span style="color: rgb(147, 161, 161);">// 实现文件“定义”</span>
<span style="color: rgb(38, 139, 210);">NSString</span> *<span style="color: rgb(133, 153, 0);">const</span> EOCStringConstant = <span style="color: rgb(42, 161, 152);">@"VALUE"</span>;</code>
</pre>
<p style="text-align: justify; word-break: break-word; color: rgb(47, 47, 47); font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(252, 250, 242);">常量定义应从右至左解读，在这里：EOCStringConstant 就是“一个常量，而这个常量是指针，指向 NSString 对象”。<br/>
关键字 <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">extern</code> 告诉编译器，在全局符号表中将会有一个名为 EOCStringConstant 的符号。</p>
<p style="text-align: justify; word-break: break-word; color: rgb(47, 47, 47); font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(252, 250, 242);">若要将 <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">EOCAnimatedView</code> 类中的动画时长对外公布，可声明如下：</p>
<pre style="padding: 9.5px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; color: rgb(101, 123, 131); border-radius: 4px; word-break: break-all; word-wrap: normal; white-space: pre; border: 1px solid rgba(0, 0, 0, 0.14902); overflow: auto; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background: rgb(253, 246, 227);">
<code style="padding: 0px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre; background-color: transparent;"><span style="color: rgb(147, 161, 161);">// EOCAnimatedView.h</span>
<span style="color: rgb(133, 153, 0);">extern</span> <span style="color: rgb(133, 153, 0);">const</span> <span style="color: rgb(38, 139, 210);">NSTimeInterval</span> EO<span style="color: rgb(38, 139, 210);">CAnimatedViewAnimationDuration</span>;

<span style="color: rgb(147, 161, 161);">// EOCAnimatedView.m</span>
<span style="color: rgb(133, 153, 0);">const</span> <span style="color: rgb(38, 139, 210);">NSTimeInterval</span> EO<span style="color: rgb(38, 139, 210);">CAnimatedViewAnimationDuration</span> = <span style="color: rgb(42, 161, 152);">0.3</span>;</code>
</pre>
<p style="text-align: justify; word-break: break-word; color: rgb(47, 47, 47); font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(252, 250, 242);">要点：</p>
<ul style="padding: 0px; text-align: justify; word-break: break-word; color: rgb(47, 47, 47); font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(252, 250, 242);">
<li>不要用预处理指令定义常量（不含类型信息）。</li>
<li>在实现文件中用 <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">static const</code> 来定义“只在编译单元内可见的常量”（translation-unit-specific constant）</li>
<li>在头文件中使用 <code style="padding: 2px 4px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 12px; color: rgb(101, 123, 131); border-radius: 3px; border: none; white-space: pre-wrap; background-color: rgb(253, 246, 227);">extern</code> 声明全局变量，并在相关实现文件定义其值。</li>
</ul>
<div style="padding: 10px 15px; border-left-width: 4px; border-left-style: solid; border-left-color: rgb(153, 153, 153); word-break: break-word; font-size: 15px; font-weight: 100; color: rgb(47, 47, 47); font-family: 'lucida grande', 'lucida sans unicode', lucida, helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: whitesmoke;margin-left:40px;">
<div><br/></div>
<div style="font-size: 15px; font-weight: normal; text-align: justify; word-break: break-word;">
<div>主要来源：<a href="http://book.douban.com/subject/25829244/" target="_blank" style="color: rgb(64, 148, 199); text-decoration: none;">《Effective Objective-C 2.0》</a></div>
</div>
</div>
</div>
</body></html>